window.glaze={};
(function(){function j(b,d,a){function c(c){f=f||c;typeof a==="function"?a(f):console.error(f)}var e=new XMLHttpRequest,f;e.addEventListener("load",function(){d(e.responseText)},!1);e.addEventListener("error",c,!1);e.addEventListener("abort",c,!1);try{e.open("GET",window.encodeURI(b),!0),e.send(null)}catch(h){f=h}}function i(b){if(b instanceof window.HTMLElement)return b;typeof b==="string"&&(b=b[0]==="#"?b.slice(1):b);return document.getElementById(b)}function k(b,d){var a=i(b),a=a?a.innerHTML:null;
typeof d==="function"&&d(a);return a}(function(){function b(){a.forEach(function(a){a.queue.forEach(function(b){glaze.canvas=a.canvas;glaze.gl=a.canvas.getContext("experimental-webgl");b.call(glaze.canvas,glaze.gl)});a.queue.length=0})}function d(){b();window.removeEventListener("DOMContentLoaded",d,!1)}var a=[];glaze.ready=function(c,d){var f,h,c=i(c);if(a.some(function(a){return a.canvas===c})){f=0;for(h=a.length;f<h;f++)if(a[f].canvas===c){a.queue.push(d);break}}else a.push({canvas:c,queue:[d]});
window.readyState==="complete"&&b()};window.readyState!=="complete"&&window.addEventListener("DOMContentLoaded",d,!1)})();if(typeof window.requestAnimationFrame!=="function")window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(b){window.setTimeout(b,1E3/60)};glaze.animate=function(b){var d=Array.prototype.slice.call(arguments,1),a=d[0]instanceof HTMLElement?d.shift():glaze.canvas;d.length===
0&&(d=null);(function e(){b.apply(a,d);window.requestAnimationFrame(e,a)})()};glaze.createShader=function(b,d){var a,c=this instanceof WebGLRenderingContext?this:glaze.gl;if(b==="vertex")b=c.VERTEX_SHADER;if(b==="fragment")b=c.FRAGMENT_SHADER;a=c.createShader(b);c.shaderSource(a,d);c.compileShader(a);return a};glaze.loadShader=function(b,d){var a=Array.prototype.slice.call(arguments),c=typeof a[a.length-1]==="function"?a.pop():null,e=this instanceof WebGLRenderingContext?this:glaze.gl,f=glaze.canvas?
glaze.canvas:null,a=i(b);if(d==="fragment")d=e.FRAGMENT_SHADER;if(d==="vertex")d=e.VERTEX_SHADER;if(a)return a=glaze.createShader.call(e,d,k(a)),typeof c==="function"&&c.call(f,a),a;else j(b,function(a){c.call(f,glaze.createShader.call(e,d,a))})};glaze.createProgram=function(b,d){var a,c=this instanceof WebGLRenderingContext?this:glaze.gl;a=c.createProgram();c.attachShader(a,b);c.attachShader(a,d);c.linkProgram(a);return a};glaze.loadProgram=function(b){var d,a,c,e;d=Array.prototype.slice.call(arguments);
var f=typeof d[d.length-1]==="function"?d.pop():null,h=glaze.canvas?glaze.canvas:null,g=this instanceof WebGLRenderingContext?this:glaze.gl;d=i(b.vertex);a=i(b.fragment);d&&(c=glaze.loadShader.call(g,d,g.VERTEX_SHADER));a&&(e=glaze.loadShader.call(g,a,g.FRAGMENT_SHADER));if(c&&e)return d=glaze.createProgram.call(g,c,e),typeof f==="function"&&f.call(h,d),d;c||glaze.loadShader.call(g,b.vertex,g.VERTEX_SHADER,function(a){e?f.call(h,glaze.createProgram.call(g,a,e)):c=a});e||glaze.loadShader.call(g,b.fragment,
g.FRAGMENT_SHADER,function(a){c?f.call(h,glaze.createProgram.call(g,c,a)):e=a})};glaze.createAttribute=function(b,d){var a,c=this instanceof WebGLRenderingContext?this:glaze.gl;c.useProgram(b);a=c.getAttribLocation(b,d);c.enableVertexAttribArray(a);return a};glaze.createUniform=function(b,d){var a=this instanceof WebGLRenderingContext?this:glaze.gl;a.useProgram(b);return a.getUniformLocation(b,d)};glaze.createBuffer=function(b,d,a){var c=this instanceof WebGLRenderingContext?this:glaze.gl,e,d=d===
void 0?c.ARRAY_BUFFER:d,a=a===void 0?c.STATIC_DRAW:a;e=c.createBuffer();c.bindBuffer(d,e);d===c.ARRAY_BUFFER?(Array.isArray(b)&&(b=new window.Float32Array(b)),c.bufferData(c.ARRAY_BUFFER,b,a)):(Array.isArray(b)&&(b=new window.Uint16Array(b)),c.bufferData(c.ELEMENT_ARRAY_BUFFER,b,a));return e};glaze.createTexture=function(b,d){var a=this instanceof WebGLRenderingContext?this:glaze.gl,c=a.createTexture(),d=d===void 0?a.RGBA:d;a.bindTexture(a.TEXTURE_2D,c);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!0);a.texImage2D(a.TEXTURE_2D,
0,d,d,a.UNSIGNED_BYTE,b);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST);a.generateMipmap(a.TEXTURE_2D);a.bindTexture(a.TEXTURE_2D,null);return c};glaze.loadTexture=function(b,d){function a(){throw new URIError("glaze.loadTexture: Unable to load "+c.src);}var c,e=glaze.canvas?glaze.canvas:null,f=this instanceof WebGLRenderingContext?this:glaze.gl;typeof b!=="string"?c=b:b[0]==="#"?(b=b[0]==="#"?b.slice(1):b,c=document.getElementById(b)):
(c=new window.Image,c.src=window.encodeURI(b));if(!c instanceof window.Image)throw new ReferenceError("glaze.loadTexture: Image must be an element or url.");c.complete?d.call(e,glaze.createTexture.call(f,c)):(c.addEventListener("load",function(){d.call(e,glaze.createTexture.call(f,c))}),c.addEventListener("error",a),c.addEventListener("abort",a))}})();
